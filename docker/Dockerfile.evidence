FROM node:20-slim

WORKDIR /evidence

# Copy your Evidence project files
COPY ./evidence/ .

# Install deps and rebuild native bindings for this container's arch
RUN npm install
RUN npm rebuild sqlite3

# Build the static site
RUN npm run sources && npm run build

# Serve with a lightweight static server
RUN npm install -g serve

EXPOSE 3000
CMD ["serve", "build", "-p", "3000"]